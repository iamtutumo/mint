{% extends "html/base.html" %}

{% block title %}Invoice {{ invoice_number }}{% endblock %}

{% block content %}
    <div class="document-info">
        <div>
            <h2 class="mt-0">INVOICE</h2>
            <p class="mb-0"><strong>Invoice #:</strong> {{ invoice_number }}</p>
            <p class="mt-0"><strong>Date:</strong> {{ invoice_date }}</p>
            <p class="mt-0"><strong>Due Date:</strong> {{ due_date }}</p>
            <p class="mt-0"><strong>Status:</strong> 
                <span class="status status-{{ status|lower }}">{{ status|upper }}</span>
            </p>
        </div>
        <div class="text-right">
            <h3 class="mt-0">{{ business_name }}</h3>
            <p class="mb-0">{{ business_address | replace('\n', '<br>') | safe }}</p>
            <p class="mt-0">
                {% if business_vat %}VAT: {{ business_vat }}<br>{% endif %}
                {{ business_phone }}<br>
                {{ business_email }}
            </p>
        </div>
    </div>

    <div class="customer-info">
        <h3>Bill To:</h3>
        <p class="mb-0"><strong>{{ customer_name }}</strong></p>
        {% if customer_company %}<p class="mt-0">{{ customer_company }}</p>{% endif %}
        <p class="mt-0">{{ customer_address | replace('\n', '<br>') | safe }}</p>
        <p class="mt-0">
            {{ customer_phone }}<br>
            {{ customer_email }}
        </p>
    </div>

    <table>
        <thead>
            <tr>
                <th>Item</th>
                <th>Description</th>
                <th class="text-right">Quantity</th>
                <th class="text-right">Unit Price</th>
                <th class="text-right">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ item.name }}</td>
                <td>{{ item.description or 'N/A' }}</td>
                <td class="text-right">{{ item.quantity }}</td>
                <td class="text-right">{{ item.unit_price | format_currency }}</td>
                <td class="text-right">{{ (item.quantity * item.unit_price) | format_currency }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
                <td class="text-right">{{ subtotal | format_currency }}</td>
            </tr>
            {% if tax_amount > 0 %}
            <tr>
                <td colspan="4" class="text-right">
                    <strong>Tax ({{ tax_rate }}%):</strong>
                </td>
                <td class="text-right">{{ tax_amount | format_currency }}</td>
            </tr>
            {% endif %}
            {% if discount_amount > 0 %}
            <tr>
                <td colspan="4" class="text-right">
                    <strong>Discount ({{ discount_rate }}%):</strong>
                </td>
                <td class="text-right">-{{ discount_amount | format_currency }}</td>
            </tr>
            {% endif %}
            {% if shipping_amount > 0 %}
            <tr>
                <td colspan="4" class="text-right"><strong>Shipping:</strong></td>
                <td class="text-right">{{ shipping_amount | format_currency }}</td>
            </tr>
            {% endif %}
            <tr class="total-row">
                <td colspan="4" class="text-right"><strong>Total:</strong></td>
                <td class="text-right">{{ total | format_currency }}</td>
            </tr>
            {% if amount_paid > 0 %}
            <tr>
                <td colspan="4" class="text-right"><strong>Amount Paid:</strong></td>
                <td class="text-right">-{{ amount_paid | format_currency }}</td>
            </tr>
            <tr class="total-row">
                <td colspan="4" class="text-right"><strong>Balance Due:</strong></td>
                <td class="text-right">{{ balance_due | format_currency }}</td>
            </tr>
            {% endif %}
        </tfoot>
    </table>

    {% if notes %}
    <div class="notes">
        <h4>Notes</h4>
        <p>{{ notes | replace('\n', '<br>') | safe }}</p>
    </div>
    {% endif %}

    <div class="payment-instructions">
        <h4>Payment Instructions</h4>
        <p>{{ payment_instructions | replace('\n', '<br>') | safe }}</p>
    </div>
{% endblock %}
