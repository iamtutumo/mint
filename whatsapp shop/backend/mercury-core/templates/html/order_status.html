{% extends "html/base.html" %}

{% block title %}Order Status - {{ order_number }}{% endblock %}

{% block content %}
    <div class="header">
        <h1>ORDER STATUS</h1>
        <p class="business-info">
            Order #{{ order_number }}<br>
            Date: {{ order_date }}
        </p>
    </div>

    <div class="status-banner" style="background-color: #e8f4fd; padding: 15px; border-radius: 5px; margin: 20px 0; text-align: center;">
        <h2 style="margin-top: 0; color: #0c5460;">
            Your Order is 
            <span class="status status-{{ order_status|lower }}">{{ order_status|upper }}</span>
        </h2>
        {% if tracking_number %}
            <p style="margin-bottom: 0;">
                <strong>Tracking Number:</strong> {{ tracking_number }}<br>
                <strong>Shipping Carrier:</strong> {{ shipping_carrier }}
            </p>
        {% endif %}
    </div>

    <div class="order-details" style="display: flex; justify-content: space-between; margin: 20px 0;">
        <div style="flex: 1; margin-right: 20px;">
            <h3>Shipping Address</h3>
            <p class="mb-0"><strong>{{ shipping_address.name }}</strong></p>
            <p class="mt-0">
                {{ shipping_address.street }}<br>
                {% if shipping_address.street2 %}{{ shipping_address.street2 }}<br>{% endif %}
                {{ shipping_address.city }}, {{ shipping_address.state }} {{ shipping_address.zip_code }}<br>
                {{ shipping_address.country }}<br>
                {{ shipping_address.phone }}
            </p>
        </div>
        <div style="flex: 1;">
            <h3>Billing Address</h3>
            <p class="mb-0"><strong>{{ billing_address.name }}</strong></p>
            <p class="mt-0">
                {{ billing_address.street }}<br>
                {% if billing_address.street2 %}{{ billing_address.street2 }}<br>{% endif %}
                {{ billing_address.city }}, {{ billing_address.state }} {{ billing_address.zip_code }}<br>
                {{ billing_address.country }}<br>
                {{ billing_address.phone }}
            </p>
        </div>
    </div>

    <h3>Order Summary</h3>
    <table>
        <thead>
            <tr>
                <th>Item</th>
                <th>Status</th>
                <th class="text-right">Qty</th>
                <th class="text-right">Price</th>
                <th class="text-right">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>
                    <strong>{{ item.name }}</strong>
                    {% if item.variant %}<br><small>{{ item.variant }}</small>{% endif %}
                    <div class="item-status" style="font-size: 12px; color: #6c757d;">
                        Status: <span class="status status-{{ item.status|lower }}">{{ item.status|upper }}</span>
                    </div>
                </td>
                <td>{{ item.status|title }}</td>
                <td class="text-right">{{ item.quantity }}</td>
                <td class="text-right">{{ item.price | format_currency }}</td>
                <td class="text-right">{{ (item.quantity * item.price) | format_currency }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4" class="text-right"><strong>Subtotal:</strong></td>
                <td class="text-right">{{ subtotal | format_currency }}</td>
            </tr>
            {% if shipping_cost > 0 %}
            <tr>
                <td colspan="4" class="text-right"><strong>Shipping & Handling:</strong></td>
                <td class="text-right">{{ shipping_cost | format_currency }}</td>
            </tr>
            {% endif %}
            {% if tax_amount > 0 %}
            <tr>
                <td colspan="4" class="text-right"><strong>Tax ({{ tax_rate }}%):</strong></td>
                <td class="text-right">{{ tax_amount | format_currency }}</td>
            </tr>
            {% endif %}
            {% if discount_amount > 0 %}
            <tr>
                <td colspan="4" class="text-right"><strong>Discount ({{ discount_code }}):</strong></td>
                <td class="text-right">-{{ discount_amount | format_currency }}</td>
            </tr>
            {% endif %}
            <tr class="total-row">
                <td colspan="4" class="text-right"><strong>Grand Total:</strong></td>
                <td class="text-right"><strong>{{ total | format_currency }}</strong></td>
            </tr>
        </tfoot>
    </table>

    {% if order_notes %}
    <div class="order-notes" style="margin: 20px 0; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
        <h4>Order Notes</h4>
        <p>{{ order_notes | safe }}</p>
    </div>
    {% endif %}

    <div class="timeline" style="margin: 40px 0;">
        <h3>Order Timeline</h3>
        <div style="position: relative; padding-left: 30px; margin-top: 20px;">
            {% for event in timeline %}
            <div style="position: relative; padding-bottom: 20px; border-left: 2px solid #dee2e6; padding-left: 25px; margin-left: -27px;">
                <div class="timeline-dot {% if event.current %}current{% else %}past{% endif %}" style="position: absolute; left: -8px; top: 0; width: 14px; height: 14px; border-radius: 50%; border: 2px solid white;"></div>
                <div style="font-weight: 500;">{{ event.status|title }}</div>
                <div style="font-size: 12px; color: #6c757d;">{{ event.date }}</div>
                {% if event.notes %}
                <div style="font-size: 13px; margin-top: 5px; color: #495057;">{{ event.notes }}</div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="contact-support" style="text-align: center; margin: 30px 0; padding: 20px; background-color: #f8f9fa; border-radius: 5px;">
        <h3 style="margin-top: 0;">Need Help?</h3>
        <p>If you have any questions about your order, please contact our customer support team.</p>
        <p>
            <a href="mailto:{{ support_email }}" style="color: #007bff; text-decoration: none; margin: 0 10px;">{{ support_email }}</a> | 
            <a href="tel:{{ support_phone }}" style="color: #007bff; text-decoration: none; margin: 0 10px;">{{ support_phone }}</a>
        </p>
    </div>

    <div class="order-actions" style="text-align: center; margin: 30px 0;">
        <a href="{{ order_history_url }}" style="display: inline-block; background-color: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; margin: 0 10px;">View Order History</a>
        <a href="{{ contact_url }}" style="display: inline-block; background-color: #6c757d; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; margin: 0 10px;">Contact Support</a>
    </div>
{% endblock %}
