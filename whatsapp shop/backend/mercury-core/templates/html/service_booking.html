{% extends "html/base.html" %}

{% block title %}Service Booking - {{ booking_number }}{% endblock %}

{% block content %}
    <div class="header">
        <h1>SERVICE BOOKING</h1>
        <p class="business-info">
            Booking #{{ booking_number }}<br>
            Date: {{ booking_date }}
        </p>
    </div>

    <div class="status-banner" style="background-color: #e8f4fd; padding: 15px; border-radius: 5px; margin: 20px 0; text-align: center;">
        <h2 style="margin-top: 0; color: #0c5460;">
            Your Booking is 
            <span class="status status-{{ status|lower }}">{{ status|upper }}</span>
        </h2>
    </div>

    <div class="booking-details" style="display: flex; justify-content: space-between; margin: 20px 0;">
        <div style="flex: 1; margin-right: 20px;">
            <h3>Customer Details</h3>
            <p class="mb-0"><strong>{{ customer_name }}</strong></p>
            <p class="mt-0">
                {{ customer_phone }}<br>
                {{ customer_email }}
            </p>
            
            <h3 style="margin-top: 20px;">Service Address</h3>
            <p class="mt-0">
                {{ service_address.street }}<br>
                {% if service_address.street2 %}{{ service_address.street2 }}<br>{% endif %n                {{ service_address.city }}, {{ service_address.state }} {{ service_address.zip_code }}<br>
                {{ service_address.country }}
            </p>
        </div>
        <div style="flex: 1;">
            <h3>Service Information</h3>
            <p class="mb-0"><strong>Service Type:</strong> {{ service_type }}</p>
            <p class="mt-0"><strong>Service Date:</strong> {{ service_date }}</p>
            <p class="mt-0"><strong>Time Slot:</strong> {{ time_slot }}</p>
            
            {% if assigned_technician %}
            <div style="margin-top: 20px;">
                <h3>Assigned Technician</h3>
                <p class="mb-0"><strong>{{ assigned_technician.name }}</strong></p>
                <p class="mt-0">
                    {{ assigned_technician.phone }}<br>
                    {{ assigned_technician.email }}
                </p>
            </div>
            {% endif %}
        </div>
    </div>

    <h3>Service Details</h3>
    <table>
        <thead>
            <tr>
                <th>Service</th>
                <th>Description</th>
                <th class="text-right">Duration</th>
                <th class="text-right">Price</th>
            </tr>
        </thead>
        <tbody>
            {% for item in services %}
            <tr>
                <td>{{ item.name }}</td>
                <td>{{ item.description or 'N/A' }}</td>
                <td class="text-right">{{ item.duration }} mins</td>
                <td class="text-right">{{ item.price | format_currency }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3" class="text-right"><strong>Subtotal:</strong></td>
                <td class="text-right">{{ subtotal | format_currency }}</td>
            </tr>
            {% if tax_amount > 0 %}
            <tr>
                <td colspan="3" class="text-right">
                    <strong>Tax ({{ tax_rate }}%):</strong>
                </td>
                <td class="text-right">{{ tax_amount | format_currency }}</td>
            </tr>
            {% endif %}
            {% if discount_amount > 0 %}
            <tr>
                <td colspan="3" class="text-right">
                    <strong>Discount ({{ discount_code }}):</strong>
                </td>
                <td class="text-right">-{{ discount_amount | format_currency }}</td>
            </tr>
            {% endif %}
            <tr class="total-row">
                <td colspan="3" class="text-right"><strong>Total:</strong></td>
                <td class="text-right"><strong>{{ total | format_currency }}</strong></td>
            </tr>
            {% if amount_paid > 0 %}
            <tr>
                <td colspan="3" class="text-right"><strong>Amount Paid:</strong></td>
                <td class="text-right">-{{ amount_paid | format_currency }}</td>
            </tr>
            <tr>
                <td colspan="3" class="text-right"><strong>Balance Due:</strong></td>
                <td class="text-right">{{ balance_due | format_currency }}</td>
            </tr>
            {% endif %}
        </tfoot>
    </table>

    {% if special_instructions %}
    <div class="special-instructions" style="margin: 20px 0; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
        <h4>Special Instructions</h4>
        <p>{{ special_instructions | safe }}</p>
    </div>
    {% endif %}

    <div class="cancellation-policy" style="margin: 20px 0; padding: 15px; background-color: #fff3cd; border-radius: 5px;">
        <h4>Cancellation Policy</h4>
        <p>{{ cancellation_policy | safe }}</p>
    </div>

    <div class="actions" style="text-align: center; margin: 30px 0;">
        {% if status == 'confirmed' %}
            <a href="{{ reschedule_url }}" class="btn" style="display: inline-block; background-color: #17a2b8; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; margin: 0 10px;">Reschedule</a>
            <a href="{{ cancel_url }}" class="btn" style="display: inline-block; background-color: #dc3545; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; margin: 0 10px;">Cancel Booking</a>
        {% endif %}
        <a href="{{ contact_url }}" class="btn" style="display: inline-block; background-color: #6c757d; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; margin: 0 10px;">Contact Support</a>
    </div>

    <div class="reminder" style="text-align: center; margin: 30px 0; padding: 15px; background-color: #e8f4fd; border-radius: 5px;">
        <h4>Reminder</h4>
        <p>You will receive a reminder 24 hours before your scheduled service time.</p>
    </div>

    <style>
        .timeline-dot.current {
            background-color: #007bff;
        }
        .timeline-dot.past {
            background-color: #6c757d;
        }
    </style>
{% endblock %}
